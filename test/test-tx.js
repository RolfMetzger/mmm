'use strict'
const isLive = true
const {RippleAPI} = require('ripple-lib');
const txUtils = require('../tx-utils.js')
const env = require('../env-utils.js').makeEnv(isLive, '../credentials.txt', './fixtures/config.txt.fixtures')
const altnet = 'ws://s.altnet.rippletest.net:51233';
const livenet = 'wss://s1.ripple.com'

const api = new RippleAPI({
    server: isLive ? livenet : altnet
})
const txBuy1 = '{\r\n    \"type\": \"order\",\r\n    \"address\": \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\",\r\n    \"sequence\": 385,\r\n    \"id\": \"6DA19A2738747074C32D9EF7DC27716F5B386EE95214600820558AE9DC8B7E90\",\r\n    \"specification\": {\r\n      \"direction\": \"buy\",\r\n      \"quantity\": {\r\n        \"currency\": \"USD\",\r\n        \"value\": \"2\",\r\n        \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\"\r\n      },\r\n      \"totalPrice\": {\r\n        \"currency\": \"XRP\",\r\n        \"value\": \"10\"\r\n      }\r\n    },\r\n    \"outcome\": {\r\n      \"result\": \"tesSUCCESS\",\r\n      \"timestamp\": \"2017-05-30T01:44:51.000Z\",\r\n      \"fee\": \"0.000012\",\r\n      \"balanceChanges\": {\r\n        \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\": [\r\n          {\r\n            \"currency\": \"XRP\",\r\n            \"value\": \"-10.000012\"\r\n          },\r\n          {\r\n            \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n            \"currency\": \"USD\",\r\n            \"value\": \"2\"\r\n          }\r\n        ],\r\n        \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\": [\r\n          {\r\n            \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n            \"currency\": \"USD\",\r\n            \"value\": \"-2\"\r\n          },\r\n          {\r\n            \"currency\": \"XRP\",\r\n            \"value\": \"10\"\r\n          }\r\n        ],\r\n        \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\": [\r\n          {\r\n            \"counterparty\": \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\",\r\n            \"currency\": \"USD\",\r\n            \"value\": \"2\"\r\n          },\r\n          {\r\n            \"counterparty\": \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\",\r\n            \"currency\": \"USD\",\r\n            \"value\": \"-2\"\r\n          }\r\n        ]\r\n      },\r\n      \"orderbookChanges\": {\r\n        \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\": [\r\n          {\r\n            \"direction\": \"buy\",\r\n            \"quantity\": {\r\n              \"currency\": \"XRP\",\r\n              \"value\": \"10\"\r\n            },\r\n            \"totalPrice\": {\r\n              \"currency\": \"USD\",\r\n              \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n              \"value\": \"2\"\r\n            },\r\n            \"sequence\": 328,\r\n            \"status\": \"partially-filled\",\r\n            \"makerExchangeRate\": \"5\"\r\n          }\r\n        ]\r\n      },\r\n      \"ledgerVersion\": 1563507,\r\n      \"indexInLedger\": 2\r\n    }\r\n  }'
const txSell1 = '{\r\n  \"type\": \"order\",\r\n  \"address\": \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\",\r\n  \"sequence\": 346,\r\n  \"id\": \"B18B10B6ADB5B775148AD6F5EA3F335CDF293087F01D63F8C40B923AE9C43B23\",\r\n  \"specification\": {\r\n    \"direction\": \"sell\",\r\n    \"quantity\": {\r\n      \"currency\": \"XRP\",\r\n      \"value\": \"10\"\r\n    },\r\n    \"totalPrice\": {\r\n      \"currency\": \"USD\",\r\n      \"value\": \"2\",\r\n      \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\"\r\n    }\r\n  },\r\n  \"outcome\": {\r\n    \"result\": \"tesSUCCESS\",\r\n    \"timestamp\": \"2017-05-30T04:49:20.000Z\",\r\n    \"fee\": \"0.000012\",\r\n    \"balanceChanges\": {\r\n      \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\": [{\r\n        \"currency\": \"XRP\",\r\n        \"value\": \"10\"\r\n      }, {\r\n        \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n        \"currency\": \"USD\",\r\n        \"value\": \"-2\"\r\n      }],\r\n      \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\": [{\r\n        \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n        \"currency\": \"USD\",\r\n        \"value\": \"2\"\r\n      }, {\r\n        \"currency\": \"XRP\",\r\n        \"value\": \"-10.000012\"\r\n      }],\r\n      \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\": [{\r\n        \"counterparty\": \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\",\r\n        \"currency\": \"USD\",\r\n        \"value\": \"-2\"\r\n      }, {\r\n        \"counterparty\": \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\",\r\n        \"currency\": \"USD\",\r\n        \"value\": \"2\"\r\n      }]\r\n    },\r\n    \"orderbookChanges\": {\r\n      \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\": [{\r\n        \"direction\": \"sell\",\r\n        \"quantity\": {\r\n          \"currency\": \"USD\",\r\n          \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n          \"value\": \"2\"\r\n        },\r\n        \"totalPrice\": {\r\n          \"currency\": \"XRP\",\r\n          \"value\": \"10\"\r\n        },\r\n        \"sequence\": 474,\r\n        \"status\": \"partially-filled\",\r\n        \"makerExchangeRate\": \"5\"\r\n      }]\r\n    },\r\n    \"ledgerVersion\": 1566824,\r\n    \"indexInLedger\": 2\r\n  }\r\n}'


const txBoth1= '{\r\n  \"type\": \"order\",\r\n  \"address\": \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\",\r\n  \"sequence\": 346,\r\n  \"id\": \"B18B10B6ADB5B775148AD6F5EA3F335CDF293087F01D63F8C40B923AE9C43B23\",\r\n  \"specification\": {\r\n    \"direction\": \"sell\",\r\n    \"quantity\": {\r\n      \"currency\": \"XRP\",\r\n      \"value\": \"10\"\r\n    },\r\n    \"totalPrice\": {\r\n      \"currency\": \"USD\",\r\n      \"value\": \"2\",\r\n      \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\"\r\n    }\r\n  },\r\n  \"outcome\": {\r\n    \"result\": \"tesSUCCESS\",\r\n    \"timestamp\": \"2017-05-30T04:49:20.000Z\",\r\n    \"fee\": \"0.000012\",\r\n    \"balanceChanges\": {\r\n      \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\": [{\r\n        \"currency\": \"XRP\",\r\n        \"value\": \"10\"\r\n      }, {\r\n        \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n        \"currency\": \"USD\",\r\n        \"value\": \"-2\"\r\n      }],\r\n      \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\": [{\r\n        \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n        \"currency\": \"USD\",\r\n        \"value\": \"2\"\r\n      }, {\r\n        \"currency\": \"XRP\",\r\n        \"value\": \"-10.000012\"\r\n      }],\r\n      \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\": [{\r\n        \"counterparty\": \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\",\r\n        \"currency\": \"USD\",\r\n        \"value\": \"-2\"\r\n      }, {\r\n        \"counterparty\": \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\",\r\n        \"currency\": \"USD\",\r\n        \"value\": \"2\"\r\n      }]\r\n    },\r\n    \"orderbookChanges\": {\r\n      \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\": [{\r\n        \"direction\": \"sell\",\r\n        \"quantity\": {\r\n          \"currency\": \"USD\",\r\n          \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n          \"value\": \"2\"\r\n        },\r\n        \"totalPrice\": {\r\n          \"currency\": \"XRP\",\r\n          \"value\": \"10\"\r\n        },\r\n        \"sequence\": 474,\r\n        \"status\": \"partially-filled\",\r\n        \"makerExchangeRate\": \"5\"\r\n      }]\r\n    },\r\n    \"ledgerVersion\": 1566824,\r\n    \"indexInLedger\": 2\r\n  }\r\n},{\r\n    \"type\": \"order\",\r\n    \"address\": \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\",\r\n    \"sequence\": 385,\r\n    \"id\": \"6DA19A2738747074C32D9EF7DC27716F5B386EE95214600820558AE9DC8B7E90\",\r\n    \"specification\": {\r\n      \"direction\": \"buy\",\r\n      \"quantity\": {\r\n        \"currency\": \"USD\",\r\n        \"value\": \"2\",\r\n        \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\"\r\n      },\r\n      \"totalPrice\": {\r\n        \"currency\": \"XRP\",\r\n        \"value\": \"10\"\r\n      }\r\n    },\r\n    \"outcome\": {\r\n      \"result\": \"tesSUCCESS\",\r\n      \"timestamp\": \"2017-05-30T01:44:51.000Z\",\r\n      \"fee\": \"0.000012\",\r\n      \"balanceChanges\": {\r\n        \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\": [\r\n          {\r\n            \"currency\": \"XRP\",\r\n            \"value\": \"-10.000012\"\r\n          },\r\n          {\r\n            \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n            \"currency\": \"USD\",\r\n            \"value\": \"2\"\r\n          }\r\n        ],\r\n        \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\": [\r\n          {\r\n            \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n            \"currency\": \"USD\",\r\n            \"value\": \"-2\"\r\n          },\r\n          {\r\n            \"currency\": \"XRP\",\r\n            \"value\": \"10\"\r\n          }\r\n        ],\r\n        \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\": [\r\n          {\r\n            \"counterparty\": \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\",\r\n            \"currency\": \"USD\",\r\n            \"value\": \"2\"\r\n          },\r\n          {\r\n            \"counterparty\": \"rDnUEzgvZHE6UX7ZJXBA4wt5jWC4uwXAjL\",\r\n            \"currency\": \"USD\",\r\n            \"value\": \"-2\"\r\n          }\r\n        ]\r\n      },\r\n      \"orderbookChanges\": {\r\n        \"rD8dZy2cXdzURTbFb3bhebQ3FFvaWCB8Nx\": [\r\n          {\r\n            \"direction\": \"buy\",\r\n            \"quantity\": {\r\n              \"currency\": \"XRP\",\r\n              \"value\": \"10\"\r\n            },\r\n            \"totalPrice\": {\r\n              \"currency\": \"USD\",\r\n              \"counterparty\": \"rHjGuGDJvKQ2RSLj3WesnxVoKVVhbSwYQL\",\r\n              \"value\": \"2\"\r\n            },\r\n            \"sequence\": 328,\r\n            \"status\": \"partially-filled\",\r\n            \"makerExchangeRate\": \"5\"\r\n          }\r\n        ]\r\n      },\r\n      \"ledgerVersion\": 1563507,\r\n      \"indexInLedger\": 2\r\n    }\r\n  }'

const txSell2 = '\r\n\r\n{\r\n   \"type\": \"order\",\r\n   \"address\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n   \"sequence\": 241,\r\n   \"id\": \"4BB03681E3FCCC86F90B8CCCF16C4AB1464F6D14C9930AC19636023DEA4D1ABA\",\r\n   \"specification\": {\r\n      \"direction\": \"sell\",\r\n      \"quantity\": {\r\n         \"currency\": \"XRP\",\r\n         \"value\": \"10\"\r\n      },\r\n      \"totalPrice\": {\r\n         \"currency\": \"JPY\",\r\n         \"value\": \"286.7\",\r\n         \"counterparty\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\"\r\n      }\r\n   },\r\n   \"outcome\": {\r\n      \"result\": \"tesSUCCESS\",\r\n      \"timestamp\": \"2017-06-01T00:46:02.000Z\",\r\n      \"fee\": \"0.00012\",\r\n      \"balanceChanges\": {\r\n         \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\": [\r\n            {\r\n               \"counterparty\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n               \"currency\": \"JPY\",\r\n               \"value\": \"286.78678633674\"\r\n            },\r\n            {\r\n               \"currency\": \"XRP\",\r\n               \"value\": \"-10.00012\"\r\n            }\r\n         ],\r\n         \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\": [\r\n            {\r\n               \"counterparty\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n               \"currency\": \"JPY\",\r\n               \"value\": \"-286.78678633674\"\r\n            },\r\n            {\r\n               \"counterparty\": \"rBZ6C6PTTscDUfGiSSdtdRK5ZzSRLuyqtM\",\r\n               \"currency\": \"JPY\",\r\n               \"value\": \"287.36035990941\"\r\n            }\r\n         ],\r\n         \"rBZ6C6PTTscDUfGiSSdtdRK5ZzSRLuyqtM\": [\r\n            {\r\n               \"counterparty\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n               \"currency\": \"JPY\",\r\n               \"value\": \"-287.36035990941\"\r\n            },\r\n            {\r\n               \"currency\": \"XRP\",\r\n               \"value\": \"10\"\r\n            }\r\n         ]\r\n      },\r\n      \"orderbookChanges\": {\r\n         \"rBZ6C6PTTscDUfGiSSdtdRK5ZzSRLuyqtM\": [\r\n            {\r\n               \"direction\": \"buy\",\r\n               \"quantity\": {\r\n                  \"currency\": \"XRP\",\r\n                  \"value\": \"10\"\r\n               },\r\n               \"totalPrice\": {\r\n                  \"currency\": \"JPY\",\r\n                  \"counterparty\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n                  \"value\": \"286.78678633674\"\r\n               },\r\n               \"sequence\": 669874,\r\n               \"status\": \"partially-filled\",\r\n               \"makerExchangeRate\": \"0.03486911000236246\"\r\n            }\r\n         ]\r\n      },\r\n      \"ledgerVersion\": 30172302,\r\n      \"indexInLedger\": 45\r\n   }\r\n}\r\n\r\n'

const txBuy2ReversedCounter = '{\r\n  \"type\": \"order\",\r\n  \"address\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n  \"sequence\": 184,\r\n  \"id\": \"B26421DE98E404537D01214BE681C29A8BF7CC876F0BE6BA487831782B69810E\",\r\n  \"specification\": {\r\n    \"direction\": \"buy\",\r\n    \"quantity\": {\r\n      \"currency\": \"XRP\",\r\n      \"value\": \"2\"\r\n    },\r\n    \"totalPrice\": {\r\n      \"currency\": \"JPY\",\r\n      \"value\": \"54\",\r\n      \"counterparty\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\"\r\n    }\r\n  },\r\n  \"outcome\": {\r\n    \"result\": \"tesSUCCESS\",\r\n    \"timestamp\": \"2017-05-31T06:45:12.000Z\",\r\n    \"fee\": \"0.000012\",\r\n    \"balanceChanges\": {\r\n      \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\": [{\r\n        \"counterparty\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n        \"currency\": \"JPY\",\r\n        \"value\": \"-53.505329069405\"\r\n      }, {\r\n        \"currency\": \"XRP\",\r\n        \"value\": \"1.999988\"\r\n      }],\r\n      \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\": [{\r\n        \"counterparty\": \"raNDu1gNyZ5hipBTKxm5zx7NovA1rNnNRf\",\r\n        \"currency\": \"JPY\",\r\n        \"value\": \"53.505329069405\"\r\n      }, {\r\n        \"counterparty\": \"rD8LigXE7165r3VWhSQ4FwzJy7PNrTMwUq\",\r\n        \"currency\": \"JPY\",\r\n        \"value\": \"-53.398532005\"\r\n      }],\r\n      \"rD8LigXE7165r3VWhSQ4FwzJy7PNrTMwUq\": [{\r\n        \"counterparty\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n        \"currency\": \"JPY\",\r\n        \"value\": \"53.398532005\"\r\n      }, {\r\n        \"currency\": \"XRP\",\r\n        \"value\": \"-2\"\r\n      }]\r\n    },\r\n    \"orderbookChanges\": {\r\n      \"rD8LigXE7165r3VWhSQ4FwzJy7PNrTMwUq\": [{\r\n        \"direction\": \"buy\",\r\n        \"quantity\": {\r\n          \"currency\": \"JPY\",\r\n          \"counterparty\": \"rB3gZey7VWHYRqJHLoHDEJXJ2pEPNieKiS\",\r\n          \"value\": \"53.39853200539\"\r\n        },\r\n        \"totalPrice\": {\r\n          \"currency\": \"XRP\",\r\n          \"value\": \"2\"\r\n        },\r\n        \"sequence\": 3952958,\r\n        \"status\": \"partially-filled\",\r\n        \"makerExchangeRate\": \"26.6992660026975\"\r\n      }]\r\n    },\r\n    \"ledgerVersion\": 30154145,\r\n    \"indexInLedger\": 1\r\n  }\r\n}'

function makeDuplicates(){
var i
var prefix = '';
var txString = '['
for(i =0; i < 10; i++){
  txString += prefix
  prefix = ','
  txString += txSell1
}
txString += ']'
}

function makeString(){
  var txString = '[' + txBuy2ReversedCounter + ']'
  return txString
}


function performRealCounter(){
  api.connect().then(() => {
    txUtils.performCounter(JSON.parse(makeString()), api, env )
  })

}


//performRealCounter()
function testfilterTxsForObChange(){
  let obChangePromises = txUtils.filterTxsForObChange(JSON.parse(makeString()), env)

  Promise.all(obChangePromises).then( obChanges => {
    obChanges.forEach(console.log)
  })


}

testfilterTxsForObChange()


